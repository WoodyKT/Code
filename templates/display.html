<html lang="en" onclick="toggleDebug()">
   <style>
      .debug {
      opacity: 0%;
      position: absolute;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 50px;
      color: rgb(0, 0, 0);
      flex-wrap: nowrap;
      font-weight: bold;
      animation-name: debugAnimation;
      animation-duration: 5s;
      animation-iteration-count: infinite;
      }
   </style>
   <head>
      <title>Smart Pot Display</title>
   </head>
   <body >
      <link rel="stylesheet" href="static\styles\formatting.css">
      <img class="plantIcon" src="static/images/plant.png">
      <img class="weatherIcon" src>
      <h1 class="time" id="time"></h1>
      <div class="sensorIcons">
         <div class="leftIcons">
            <div>
               <img class="humidityIcon">
               <p class="debug" id="humidity"></p>
            </div>
            <div>
               <img class="moistureIcon">
               <p class="debug" id="moisture"></p>
            </div>
         </div>
         <div class="rightIcons">
            <div>
               <img class="waterIcon">
               <p class="debug" id="water"></p>
            </div>
            <div>
               <img class="lightIcon">
               <p class="debug" id="light"></p>
            </div>
            <div>
               <img class="temperatureIcon">
               <p class="debug" id="temperature"></p>
            </div>
         </div>
      </div>
      <p class="debug" id="debug" style="top: 0%;left: 2%;">debug</p>
   </body>
</html>
<script>
   var debug = false;
   
    window.onload = function() {
       Update(); // Run once immediately
       UpdateWeather();
       setInterval(Update, 1000); // Then run every second
       setInterval(UpdateWeather,900000)//Run every 15 mins
   };
   
   
   function toggleDebug() {
       const items = document.querySelectorAll(".debug");
       debug = !debug;
       for (const item of items) {
           item.style.opacity = debug ? "100" : "0";
       }
   }
   
   function Update() {
   document.getElementById("time").innerHTML = new Date().toTimeString().slice(0, 5);
   
   fetch("static/sensorData.txt")
       .then((res) => res.text())
       .then((text) => {
           const values = text.trim().split(',');
   
           if (values.length >= 4) {
               const lightVal = values[0];
               const humidityVal = values[1];
               const moistureVal = values[2];
               const temperatureVal = values[3];
               const waterLevelVal = values[4]
   
               document.getElementById("light").innerHTML = lightVal;
               document.getElementById("humidity").innerHTML = humidityVal;
               document.getElementById("moisture").innerHTML = moistureVal;
               document.getElementById("temperature").innerHTML = temperatureVal;
               document.getElementById("water").innerHTML = waterLevelVal;
   
   
               // Set image srcs based on value
               document.querySelector(".lightIcon").src = `static/images/light/${getColor(lightVal)}.png`;
               document.querySelector(".humidityIcon").src = `static/images/humidity/${getColor(humidityVal)}.png`;
               document.querySelector(".moistureIcon").src = `static/images/moisture/${getColor(moistureVal)}.png`;
               document.querySelector(".temperatureIcon").src = `static/images/temperature/${getColor(temperatureVal)}.png`;
               document.querySelector(".waterIcon").src = `static/images/waterLevel/${getColor(waterLevelVal)}.png`;
   
           }
       })
       .catch((err) => {
           console.error("Error fetching sensor data:", err);
       });
   }
   
   
   
   function getColor(value) {
   if (value<250 || value >750) return "red";
   if (value < 400 || value > 600) return "orange";
   return "green";
   }
   
   function getWeatherIcon(weatherMain) {
   // Map API response to your icon filenames
   const map = {
       Clear: "sunny",
       Clouds: "sunnyCloud",
       Rain: "rainy",
       Drizzle: "sunnyRain",
       Thunderstorm: "stormy",
       Snow: "snowy",
       Mist: "foggy",
       Smoke: "foggy",
       Haze: "foggy",
       Dust: "foggy",
       Fog: "foggy",
       Sand: "foggy",
       Ash: "foggy",
       Squall: "stormy",
       Tornado: "stormy"
   };
     return map[weatherMain] || "sunny"; // default fallback
   }
   function getWeatherTextColour(weatherIcon){
    const map={
        "cloudy": "darkBlue",
        "sunnyCloud": "orange",
        "foggy" : "darkBlue",
        "rainy":"white",
        "snowy":"darkBlue",
        "stormy":"white",
        "sunny":"orange",
        "sunnyRain":"white"
    };
    return map[weatherIcon]||"white";
   }
   
   
   
   function UpdateWeather() {
   const apiKey = "99d05d20435a20010a1a2f22deb59bc0";  // <-- Replace with your actual API key
   const city = "Luton";          // <-- Or use coordinates
   const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}`;
   
   fetch(url)
       .then(res => res.json())
       .then(data => {
           if (!data.weather || data.weather.length === 0) return;
   
           const weatherMain = data.weather[0].main;
           const iconFile = getWeatherIcon(weatherMain);
           document.querySelector(".weatherIcon").src = `static/images/weather/${iconFile}.png`;
           document.querySelector(".time").style.color = getWeatherTextColour(iconFile);
       })
       .catch(err => {
           console.error("Error fetching weather:", err);
       });
   }
   
</script>
